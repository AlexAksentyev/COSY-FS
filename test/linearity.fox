INCLUDE 'bin/support/BNL/decoh_optim';

PROCEDURE STEERER CUR;
  RSY 90;
  CMSI CUR 1E6 5E-2 .1;
  RSY -90;
ENDPROCEDURE;
FUNCTION GET0 MU NBAR;
  GET0 := FORM((MU|0)&(NBAR(1)|0)&(NBAR(2)|0)&(NBAR(3)|0));
ENDFUNCTION;

PROCEDURE RUN;
  VARIABLE WHERE 100;
  VARIABLE TILTS 32; VARIABLE I 1;
  VARIABLE GSX 1; VARIABLE GSY 1; VARIABLE GSD 1;
  VARIABLE MUARR 800 4; VARIABLE MU 800; VARIABLE NBAR 800 3;
  VARIABLE EN 1;

  WHERE := 'data/LINEARITY/';
  OS 'mkdir -p '&WHERE;  WRITE 6 'WRITING TO: '&WHERE;
  OS 'rm -vf '&WHERE&'*';
  GROUTF 'img/dump/TR' 1;
  
  OV 3 3 0;
  RP 270.0092 1876.5592/AMUMEV 1;
  RPS 1 -.142987;
  { GSX := 5.85e-3; }
  { GSY := -2.5E-3; }
  { GSD := -1.45e-2; }

  TILTS := ZEROS(32);
  VELSET TILTS 7 -.5;
  VELSET TILTS 8 3.3;
  VELSET TILTS 16 1;
  VELSET TILTS 17 -3.3;
  VELSET TILTS 25 .5;
  VELSET TILTS 32 -1;  

  OPENF 7 FILENAME(WHERE, 'STUNE0', 'CW') 'REPLACE';
  WRITE 7 '# HEADER: I MU0 NX NY NZ';
  LOOP I 0 10; 
    { VELSET TILTS 14 (I-5)*1E-6/DEGRAD; }
    { OPENF 8 WHERE&'GAUSS:'&MRK(I)&'.in' 'REPLACE'; }
    { COLWRITE 8 TILTS; CLOSEF 8; }
    TILTS := VEGAUSS((I-5)*1E-4/DEGRAD, 1E-5/DEGRAD, 32, WHERE&'GAUSS:'&MRK(I));
    CW_SETUP GSX GSY GSD TILTS;
    TSS MU NBAR 0;
    WRITE 6 SF(I, '(I4)')&GET0(MU, NBAR);
    WRITE 7 SF(I, '(I4)')&GET0(MU, NBAR);
  ENDLOOP;  
  CLOSEF 7;

ENDPROCEDURE; {RUN}

RUN; END;
